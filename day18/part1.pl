#!/usr/bin/perl

use strict;
use warnings;

my %m = (
  '#' => 1,
  '.' => 0,
);

open(INFILE, 'input.txt') or die "Cannot open file input.txt for reading: $!";
while(<INFILE>) {
  chomp;
  push @_, [map {$m{$_}} split ''];
}
close INFILE;

for (1..100) {
    my @n;
    $n[0][0] = $_[0][1] + $_[1][0] + $_[1][1];
    for (my $y = 1; $y < $#_; ++$y) {
        $n[0][$y] = $_[0][$y-1] + $_[0][$y+1] + $_[1][$y-1] + $_[1][$y] + $_[1][$y+1];
    }
    $n[0][$#_] = $_[0][$#_-1] + $_[1][$#_] + $_[1][$#_-1];
    for (my $x = 1; $x < $#_; ++$x) {
        $n[$x][0] = $_[$x-1][0] + $_[$x-1][1] + $_[$x][1] + $_[$x+1][0] + $_[$x+1][1];
        for (my $y = 1; $y < $#_; ++$y) {
            $n[$x][$y] = $_[$x-1][$y-1] + $_[$x-1][$y] + $_[$x-1][$y+1] + $_[$x][$y-1] + $_[$x][$y+1] + $_[$x+1][$y-1] + $_[$x+1][$y] + $_[$x+1][$y+1];
        }
        $n[$x][$#_] = $_[$x-1][$#_] + $_[$x-1][$#_-1] + $_[$x][$#_-1] + $_[$x+1][$#_] + $_[$x+1][$#_-1];
    }
    $n[$#_][0] = $_[$#_][1] + $_[$#_-1][0] + $_[$#_-1][1];
    for (my $y = 1; $y < $#_; ++$y) {
        $n[$#_][$y] = $_[$#_][$y-1] + $_[$#_][$y+1] + $_[$#_-1][$y-1] + $_[$#_-1][$y] + $_[$#_-1][$y+1];
    }
    $n[$#_][$#_] = $_[$#_][$#_-1] + $_[$#_-1][$#_] + $_[$#_-1][$#_-1];
    for my $x (0..$#_) {
        for my $y (0..$#_) {
            $_[$x][$y] = $_[$x][$y] ? ($n[$x][$y] == 2 || $n[$x][$y] == 3) : ($n[$x][$y] == 3);
        }
    }
}

print scalar(grep {$_} map {@$_} @_) . "\n";
